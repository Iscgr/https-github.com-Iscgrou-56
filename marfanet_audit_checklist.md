# چک‌لیست جامع نقاط ضعف و نیازمندی‌های فنی اپلیکیشن MarFaNet

... (محتوای قبلی فایل)

---

### ۲. ماژول: مدیریت نمایندگان (Agents)

- [x] **کند بودن بارگذاری لیست نمایندگان:** محاسبه آنی خلاصه‌های مالی (موجودی، بدهی) برای لیست نمایندگان، با افزایش داده‌ها بسیار کند خواهد شد.
    - **راهکار:** پیاده‌سازی الگوی CQRS با استفاده از یک جدول خلاصه‌ساز (`AgentFinancialSummaries`) که در پس‌زمینه و توسط رویدادها (Events) به‌روز می‌شود.
    - **یادداشت پیاده‌سازی:** انجام شد. مدل داده `AgentFinancialSummary` و توابع `getAgentSummaries` و `updateAgentFinancialSummary` در `data.ts` پیاده‌سازی شدند. UI برای خواندن از این مدل بهینه شد.

- [x] **ابهام در منبع حقیقت داده (Source of Truth):** ریسک استفاده از داده‌های خلاصه‌سازی شده (که ممکن است کهنه باشند) برای گزارش‌های رسمی.
    - **راهکار:** تعریف قانون معماری: جدول خلاصه‌ها **فقط برای نمایش در UI** است. تمام گزارش‌های رسمی باید مستقیماً از جداول اصلی استعلام شوند.
    - **یادداشت پیاده‌سازی:** انجام شد. این قانون به عنوان یک اصل معماری در سند `docs/blueprint.md` مستند گردید.

- [x] **عدم وجود مکانیزم مغایرت‌گیری:** در صورت از دست رفتن یک رویداد، داده‌های جدول خلاصه‌ها با داده‌های واقعی مغایرت پیدا خواهد کرد.
    - **راهکار:** ایجاد یک ابزار ادمین برای "بازسازی کامل" (Full Rebuild) جدول خلاصه‌ها از روی داده‌های اصلی.
    - **یادداشت پیاده‌سازی:** انجام شد. یک `Server Action` به نام `rebuildSummariesAction` و منطق `rebuildAllSummaries` در بک‌اند برای این منظور ایجاد شد.

- [x] **ریسک از دست رفتن رویدادها:** در صورت کرش کردن پردازشگر رویداد (Listener)، رویداد از بین رفته و خلاصه‌های مالی برای همیشه اشتباه باقی می‌مانند.
    - **راهکار:** استفاده از یک صف پایدار مبتنی بر دیتابیس (`EventQueue`) به جای `EventEmitter` درون-حافظه‌ای، همراه با مکانیزم DLQ برای رویدادهای ناموفق.
    - **یادداشت پیاده‌سازی:** انجام شد. یک `eventQueue` شبیه‌سازی شده در `data.ts` ایجاد شد. عملیات نوشتن، اکنون رویدادها را به این صف ارسال می‌کنند.

- [x] **عدم اطلاع کاربر از تأخیر در همگام‌سازی (Eventual Consistency):** کاربر متوجه تأخیر چند ثانیه‌ای در به‌روزرسانی خلاصه‌های مالی پس از یک عملیات نمی‌شود.
    - **راهکار:** استفاده از یک انیمیشن ظریف (مانند پالس یا درخشش) در UI برای ردیف مربوطه جهت القای حس "در حال به‌روزرسانی".
    - **یادداشت پیاده‌سازی:** انجام شد. ستون "آخرین بروزرسانی" و یک انیمیشن پالس شرطی برای داده‌های قدیمی در `columns.tsx` صفحه نمایندگان اضافه شد.

---
... (بقیه ماژول‌ها)
